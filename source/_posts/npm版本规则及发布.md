---
title: npm版本规则及发布
date: 2023-10-19 23:13:39
tags:
categories:
---


## 版本号规则
从日常的开发中我们可以看到，npm 包的版本号的格式都是 X.Y.Z。这个格式其实是由 Gravatars 创办者兼 GitHub 共同创办者 Tom Preston-Werner 所建立。由 GitHub 起草的统一的版本号表示规则，称为 Semantic Versioning(语义化版本表示)

- X 代表主版本号，也叫做大版本号
升级大版本时意味着这个包可能做了颠覆性的改动，和低版本的包已经无法兼容。每当主版本号递增时，次版本号和修订号必须归零。
- Y 代表次版本号，也叫做小版本号
当做了向下兼容的功能性新增时，升级小版本号。每当次版本号递增时，修订号必须归零。
- Z 代表修订号
当做了向下兼容的问题修正（bugfix）时， 升级修订号。

<!--more-->

## 常见版本格式/引用方式

| 版本引用方式                         | 版本号    | 匹配版本               | 解释                                                       |
| ------------------------------------ | --------- | ----------------------- | ---------------------------------------------------------- |
| 直接使用版本号                       | 2.3.1     | 2.3.1                   | 只可以匹配 2.3.1 这个版本，如果是比较重要的项目，建议用这种方式固定版本。 |
| ^: 不能修改版本号最左侧非零数字    | ^2.3.1    | >= 2.3.1 && < 3.0.0    | 最左侧非零数字是 2                                          |
| ^0.3.1                               | ^0.3.1    | >= 0.3.1 && < 0.4.0    | 最左侧非零数字是 3                                          |
| ^0.0.1                               | ^0.01     | >= 0.01 && < 0.02      | 最左侧非零数字是 1                                          |
| ~: 版本号列出 Y 时兼容 Z 的修改     | ~2.3.1    | >= 2.3.1 && < 2.4.0    | Y 为 3。～2.3 同理                                            |
| ～2                                  | ～2       | >= 2.0.0 && < 3.0.0    | X 为 2                                                      |
| *、X、x，空：表示可以匹配任何版本   | "2.3.X"   | >= 2.3.0 && < 2.4.0    | Z 可以为任意值                                              |
| "2.X"、"2.x"、"2.*"、"2"            | "2.X"     | >= 2.0.0 && < 3.0.0    | Y、Z 为任意值                                                |
| *、X、x，空                          | 任意版本 | 任意版本               | 任意版本指的是最新的正式版                                  |

## 先行版本

npm 的先行版本号，放到 X.Y.Z 的后边，作为延伸。被标上先行版本号则表示这个版本并非稳定而且可能无法满足预期的兼容性需求。例如：1.0.0-alpha.1，2.0.0-beta.1 等。一般常用的关键词有：

alpha：预览版，或者叫内部测试版；一般不向外部发布，会有很多bug（会不太稳定）；一般只有测试人员使用。
beta：测试版，或者叫公开测试版；这个阶段的版本会一直加入新的功能；在alpha版之后推出。
rc(release candidate)：最终测试版本；可能成为最终产品的候选版本，如果未出现问题则可发布成为正式版本。

## 版本查看

以webpack为例:

```
npm dist-tag ls webpack
```
{% asset_img 1551697434683_.pic.jpg 'webpack版本' %}

## 版本发布

手动修改package.json里面的version

```
"name": "package-name",
"version": "2.3.2-beta.1"
```
使用 `npm publish`来发布的话，发布出来的包的 tag 是 latest，但是我们其实是想发布一个测试包。如果其他人 npm i 下载时就会下载 version 为 2.3.2-beta.1 的包。只有使用 npm publish --tag XXX 才是给 npm 包上打了 tag 标签

```
npm run build // 打包
npm publish --tag beta // 发布 beta 包
```
如果不小心直接使用 `npm publish` 发错了也没有关系，可以使用以下命令来添加 tag：

```
npm dist-tag add <pkg>@2.3.2-beta.1 <tag>
```
当需要删除多余的 tag 时：

```
npm dist-tag rm <pkg> <tag>
```


